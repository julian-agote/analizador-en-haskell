X = [0 0 0 1;1 1 0 1;2 -1 0 1;3 0 0 1];
%X = X * [1 0 0 0;0 cosd(90) sind(90) 0;0 -sind(90) cosd(90) 0;0 0 0 1 ];
c21=sqrt((X(2,1)-X(1,1))^2+(X(2,2)-X(1,2))^2+(X(2,3)-X(1,3))^2);
c32=sqrt((X(3,1)-X(2,1))^2+(X(3,2)-X(2,2))^2+(X(3,3)-X(2,3))^2);
c43=sqrt((X(4,1)-X(3,1))^2+(X(4,2)-X(3,2))^2+(X(4,3)-X(3,3))^2);
alfa=c21/(c32+c21);beta=c32/(c43+c32);
B=[X(1,1) X(1,2) X(1,3);X(2,1) X(2,2) X(2,3);X(3,1) X(3,2) X(3,3);X(4,1) X(4,2) X(4,3)];
P(1,:)=nahaste_par(alfa,beta,0,20,B);
P(2,:)=nahaste_par(alfa,beta,1,20,B);
P(3,:)=nahaste_par(alfa,beta,2,20,B);
P(4,:)=nahaste_par(alfa,beta,3,20,B);
P(5,:)=nahaste_par(alfa,beta,4,20,B);
P(6,:)=nahaste_par(alfa,beta,5,20,B);
P(7,:)=nahaste_par(alfa,beta,6,20,B);
P(8,:)=nahaste_par(alfa,beta,7,20,B);
P(9,:)=nahaste_par(alfa,beta,8,20,B);
P(10,:)=nahaste_par(alfa,beta,9,20,B);
P(11,:)=nahaste_par(alfa,beta,10,20,B);
P(12,:)=nahaste_par(alfa,beta,11,20,B);
P(13,:)=nahaste_par(alfa,beta,12,20,B);
P(14,:)=nahaste_par(alfa,beta,13,20,B);
P(15,:)=nahaste_par(alfa,beta,14,20,B);
P(16,:)=nahaste_par(alfa,beta,15,20,B);
P(17,:)=nahaste_par(alfa,beta,16,20,B);
P(18,:)=nahaste_par(alfa,beta,17,20,B);
P(19,:)=nahaste_par(alfa,beta,18,20,B);
P(20,:)=nahaste_par(alfa,beta,19,20,B);
P(21,:)=nahaste_par(alfa,beta,20,20,B);
X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);
X1=[P(10,1) P(11,1)];Y1=[P(10,2) P(11,2)];Z1=[P(10,3) P(11,3)];line(X1,Y1,Z1);
X1=[P(11,1) P(12,1)];Y1=[P(11,2) P(12,2)];Z1=[P(11,3) P(12,3)];line(X1,Y1,Z1);
X1=[P(12,1) P(13,1)];Y1=[P(12,2) P(13,2)];Z1=[P(12,3) P(13,3)];line(X1,Y1,Z1);
X1=[P(13,1) P(14,1)];Y1=[P(13,2) P(14,2)];Z1=[P(13,3) P(14,3)];line(X1,Y1,Z1);
X1=[P(14,1) P(15,1)];Y1=[P(14,2) P(15,2)];Z1=[P(14,3) P(15,3)];line(X1,Y1,Z1);
X1=[P(15,1) P(16,1)];Y1=[P(15,2) P(16,2)];Z1=[P(15,3) P(16,3)];line(X1,Y1,Z1);
X1=[P(16,1) P(17,1)];Y1=[P(16,2) P(17,2)];Z1=[P(16,3) P(17,3)];line(X1,Y1,Z1);
X1=[P(17,1) P(18,1)];Y1=[P(17,2) P(18,2)];Z1=[P(17,3) P(18,3)];line(X1,Y1,Z1);
X1=[P(18,1) P(19,1)];Y1=[P(18,2) P(19,2)];Z1=[P(18,3) P(19,3)];line(X1,Y1,Z1);
X1=[P(19,1) P(20,1)];Y1=[P(19,2) P(20,2)];Z1=[P(19,3) P(20,3)];line(X1,Y1,Z1);
X1=[P(20,1) P(21,1)];Y1=[P(20,2) P(21,2)];Z1=[P(20,3) P(21,3)];line(X1,Y1,Z1);
view(3);hold on;
%xlim([min(X(:,1))-1 max(X(:,1))+1]);ylim([min(X(:,2))-1 max(X(:,2))+1]);zlim([min(X(:,3))-1 max(X(:,3))+1]);xlabel('x');ylabel('y');zlabel('z');
XP = X;
for i=0:75
	XP = XP * [1 0 0 0;0 1 0 0;0 0 1 0;0.01 0 0 1]*[1 0 0 0;0 cosd(0.5) sind(0.5) 0;0 -sind(0.5) cosd(0.5) 0;0 0 0 1 ];
	c21=sqrt((XP(2,1)-XP(1,1))^2+(XP(2,2)-XP(1,2))^2+(XP(2,3)-XP(1,3))^2);
    c32=sqrt((XP(3,1)-XP(2,1))^2+(XP(3,2)-XP(2,2))^2+(XP(3,3)-XP(2,3))^2);
    c43=sqrt((XP(4,1)-XP(3,1))^2+(XP(4,2)-XP(3,2))^2+(XP(4,3)-XP(3,3))^2);
    alfa=c21/(c32+c21);beta=c32/(c43+c32);
	B=[XP(1,1) XP(1,2) XP(1,3);XP(2,1) XP(2,2) XP(2,3);XP(3,1) XP(3,2) XP(3,3);XP(4,1) XP(4,2) XP(4,3)];
	P(1,:)=nahaste_par(alfa,beta,0,20,B);
	P(2,:)=nahaste_par(alfa,beta,1,20,B);
	P(3,:)=nahaste_par(alfa,beta,2,20,B);
	P(4,:)=nahaste_par(alfa,beta,3,20,B);
	P(5,:)=nahaste_par(alfa,beta,4,20,B);
	P(6,:)=nahaste_par(alfa,beta,5,20,B);
	P(7,:)=nahaste_par(alfa,beta,6,20,B);
	P(8,:)=nahaste_par(alfa,beta,7,20,B);
	P(9,:)=nahaste_par(alfa,beta,8,20,B);
	P(10,:)=nahaste_par(alfa,beta,9,20,B);
	P(11,:)=nahaste_par(alfa,beta,10,20,B);
	P(12,:)=nahaste_par(alfa,beta,11,20,B);
	P(13,:)=nahaste_par(alfa,beta,12,20,B);
	P(14,:)=nahaste_par(alfa,beta,13,20,B);
	P(15,:)=nahaste_par(alfa,beta,14,20,B);
	P(16,:)=nahaste_par(alfa,beta,15,20,B);
	P(17,:)=nahaste_par(alfa,beta,16,20,B);
	P(18,:)=nahaste_par(alfa,beta,17,20,B);
	P(19,:)=nahaste_par(alfa,beta,18,20,B);
	P(20,:)=nahaste_par(alfa,beta,19,20,B);
	P(21,:)=nahaste_par(alfa,beta,20,20,B);
	X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
    X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
    X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
    X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
    X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
    X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
    X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
    X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
    X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);
    X1=[P(10,1) P(11,1)];Y1=[P(10,2) P(11,2)];Z1=[P(10,3) P(11,3)];line(X1,Y1,Z1);
    X1=[P(11,1) P(12,1)];Y1=[P(11,2) P(12,2)];Z1=[P(11,3) P(12,3)];line(X1,Y1,Z1);
    X1=[P(12,1) P(13,1)];Y1=[P(12,2) P(13,2)];Z1=[P(12,3) P(13,3)];line(X1,Y1,Z1);
    X1=[P(13,1) P(14,1)];Y1=[P(13,2) P(14,2)];Z1=[P(13,3) P(14,3)];line(X1,Y1,Z1);
    X1=[P(14,1) P(15,1)];Y1=[P(14,2) P(15,2)];Z1=[P(14,3) P(15,3)];line(X1,Y1,Z1);
    X1=[P(15,1) P(16,1)];Y1=[P(15,2) P(16,2)];Z1=[P(15,3) P(16,3)];line(X1,Y1,Z1);
    X1=[P(16,1) P(17,1)];Y1=[P(16,2) P(17,2)];Z1=[P(16,3) P(17,3)];line(X1,Y1,Z1);
    X1=[P(17,1) P(18,1)];Y1=[P(17,2) P(18,2)];Z1=[P(17,3) P(18,3)];line(X1,Y1,Z1);
    X1=[P(18,1) P(19,1)];Y1=[P(18,2) P(19,2)];Z1=[P(18,3) P(19,3)];line(X1,Y1,Z1);
    X1=[P(19,1) P(20,1)];Y1=[P(19,2) P(20,2)];Z1=[P(19,3) P(20,3)];line(X1,Y1,Z1);
    X1=[P(20,1) P(21,1)];Y1=[P(20,2) P(21,2)];Z1=[P(20,3) P(21,3)];line(X1,Y1,Z1);
end
XP = XP * [1 0 0 0;0 1 0 0;0 0 1 0;0.01 0 0 1]*[1 0 0 0;0 cosd(0.5) sind(0.5) 0;0 -sind(0.5) cosd(0.5) 0;0 0 0 1 ];
c21=sqrt((XP(2,1)-XP(1,1))^2+(XP(2,2)-XP(1,2))^2+(XP(2,3)-XP(1,3))^2);
c32=sqrt((XP(3,1)-XP(2,1))^2+(XP(3,2)-XP(2,2))^2+(XP(3,3)-XP(2,3))^2);
c43=sqrt((XP(4,1)-XP(3,1))^2+(XP(4,2)-XP(3,2))^2+(XP(4,3)-XP(3,3))^2);
alfa=c21/(c32+c21);beta=c32/(c43+c32);
B=[XP(1,1) XP(1,2) XP(1,3);XP(2,1) XP(2,2) XP(2,3);XP(3,1) XP(3,2) XP(3,3);XP(4,1) XP(4,2) XP(4,3)];
P(1,:)=nahaste_par(alfa,beta,0,20,B);
P(2,:)=nahaste_par(alfa,beta,1,20,B);
P(3,:)=nahaste_par(alfa,beta,2,20,B);
P(4,:)=nahaste_par(alfa,beta,3,20,B);
P(5,:)=nahaste_par(alfa,beta,4,20,B);
P(6,:)=nahaste_par(alfa,beta,5,20,B);
P(7,:)=nahaste_par(alfa,beta,6,20,B);
P(8,:)=nahaste_par(alfa,beta,7,20,B);
P(9,:)=nahaste_par(alfa,beta,8,20,B);
P(10,:)=nahaste_par(alfa,beta,9,20,B);
P(11,:)=nahaste_par(alfa,beta,10,20,B);
P(12,:)=nahaste_par(alfa,beta,11,20,B);
P(13,:)=nahaste_par(alfa,beta,12,20,B);
P(14,:)=nahaste_par(alfa,beta,13,20,B);
P(15,:)=nahaste_par(alfa,beta,14,20,B);
P(16,:)=nahaste_par(alfa,beta,15,20,B);
P(17,:)=nahaste_par(alfa,beta,16,20,B);
P(18,:)=nahaste_par(alfa,beta,17,20,B);
P(19,:)=nahaste_par(alfa,beta,18,20,B);
P(20,:)=nahaste_par(alfa,beta,19,20,B);
P(21,:)=nahaste_par(alfa,beta,20,20,B);
X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);
X1=[P(10,1) P(11,1)];Y1=[P(10,2) P(11,2)];Z1=[P(10,3) P(11,3)];line(X1,Y1,Z1);
X1=[P(11,1) P(12,1)];Y1=[P(11,2) P(12,2)];Z1=[P(11,3) P(12,3)];line(X1,Y1,Z1);
X1=[P(12,1) P(13,1)];Y1=[P(12,2) P(13,2)];Z1=[P(12,3) P(13,3)];line(X1,Y1,Z1);
X1=[P(13,1) P(14,1)];Y1=[P(13,2) P(14,2)];Z1=[P(13,3) P(14,3)];line(X1,Y1,Z1);
X1=[P(14,1) P(15,1)];Y1=[P(14,2) P(15,2)];Z1=[P(14,3) P(15,3)];line(X1,Y1,Z1);
X1=[P(15,1) P(16,1)];Y1=[P(15,2) P(16,2)];Z1=[P(15,3) P(16,3)];line(X1,Y1,Z1);
X1=[P(16,1) P(17,1)];Y1=[P(16,2) P(17,2)];Z1=[P(16,3) P(17,3)];line(X1,Y1,Z1);
X1=[P(17,1) P(18,1)];Y1=[P(17,2) P(18,2)];Z1=[P(17,3) P(18,3)];line(X1,Y1,Z1);
X1=[P(18,1) P(19,1)];Y1=[P(18,2) P(19,2)];Z1=[P(18,3) P(19,3)];line(X1,Y1,Z1);
X1=[P(19,1) P(20,1)];Y1=[P(19,2) P(20,2)];Z1=[P(19,3) P(20,3)];line(X1,Y1,Z1);
X1=[P(20,1) P(21,1)];Y1=[P(20,2) P(21,2)];Z1=[P(20,3) P(21,3)];line(X1,Y1,Z1);

