X = [2 1 2 1;3 1 2 1;3 1.5 2 1;2.5 2 2 1;2 2 2 1;2 1 1 1;3 1 1 1;3 2 1 1;2 2 1 1;3 2 1.5 1];
a=1;P=[X(8,1) X(8,2) X(8,3)];
thetamax=sqrt(P(1)/a);P(2)=2*a*thetamax;
X(8,2) = P(2);
P=[X(9,1) X(9,2) X(9,3)];
thetamin=sqrt(P(1)/a);P(2)=2*a*thetamin;
X(9,2) = P(2);
% X = X * [1 0 0 0;0 cos(90) sin(90) 0;0 -sin(90) cos(90) 0;0 0 0 1 ];
p1=1;t2 = sqrt((X(2,1) -X(1,1))^2 + (X(2,2) -X(1,2))^2 + (X(2,3) -X(1,3))^2);
p2=2;
t3 = sqrt((X(7,1) -X(2,1))^2 + (X(7,2) -X(2,2))^2 + (X(7,3) -X(2,3))^2);
p3=7;
t4 = sqrt((X(6,1) -X(7,1))^2 + (X(6,2) -X(7,2))^2 + (X(6,3) -X(7,3))^2);
p4=6;
G=[1 0.5 0 0 ;t3 2*(t2 + t3) t2 0 ;0 t4 2*(t3 + t4) t3 ;0 0  2 4]\[(3/(2*t2))*(X(p2,1)-X(p1,1))  (3/(2*t2))*(X(p2,2)-X(p1,2)) (3/(2*t2))*(X(p2,3)-X(p1,3));(3/(t2*t3))*(t2^2*(X(p3,1)-X(p2,1))+t3^2*(X(p2,1)-X(p1,1))) (3/(t2*t3))*(t2^2*(X(p3,2)-X(p2,2))+t3^2*(X(p2,2)-X(p1,2))) (3/(t2*t3))*(t2^2*(X(p3,3)-X(p2,3))+t3^2*(X(p2,3)-X(p1,3)));(3/(t3*t4))*(t3^2*(X(p4,1)-X(p3,1))+t4^2*(X(p3,1)-X(p2,1))) (3/(t3*t4))*(t3^2*(X(p4,2)-X(p3,2))+t4^2*(X(p3,2)-X(p2,2))) (3/(t3*t4))*(t3^2*(X(p4,3)-X(p3,3))+t4^2*(X(p3,3)-X(p2,3)));(6/t4)*(X(p4,1)-X(p3,1)) (6/t4)*(X(p4,2)-X(p3,2)) (6/t4)*(X(p4,3)-X(p3,3))];
P = [X(1,1) X(1,2) X(1,3);
[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t2 (1/3)*((1/3)^2-(1/3))*t2]*[X(p1,1) X(p1,2) X(p1,3); X(p2,1) X(p2,2) X(p2,3);G(1,1) G(1,2) G(1,3); G(2,1) G(2,2) G(2,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t2 (2/3)*((2/3)^2-(2/3))*t2]*[X(p1,1) X(p1,2) X(p1,3); X(p2,1) X(p2,2) X(p2,3);G(1,1) G(1,2) G(1,3); G(2,1) G(2,2) G(2,3)];
X(2,1) X(2,2) X(2,3);[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t3 (1/3)*((1/3)^2-(1/3))*t3]*[X(p2,1) X(p2,2) X(p2,3); X(p3,1) X(p3,2) X(p3,3);G(2,1) G(2,2) G(2,3); G(3,1) G(3,2) G(3,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t3 (2/3)*((2/3)^2-(2/3))*t3]*[X(p2,1) X(p2,2) X(p2,3); X(p3,1) X(p3,2) X(p3,3);G(2,1) G(2,2) G(2,3); G(3,1) G(3,2) G(3,3)];
X(7,1) X(7,2) X(7,3);[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t4 (1/3)*((1/3)^2-(1/3))*t4]*[X(p3,1) X(p3,2) X(p3,3); X(p4,1) X(p4,2) X(p4,3);G(3,1) G(3,2) G(3,3); G(4,1) G(4,2) G(4,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t4 (2/3)*((2/3)^2-(2/3))*t4]*[X(p3,1) X(p3,2) X(p3,3); X(p4,1) X(p4,2) X(p4,3);G(3,1) G(3,2) G(3,3); G(4,1) G(4,2) G(4,3)];
X(6,1) X(6,2) X(6,3)];
% subplot(1,2,1);
X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);
view(3);hold on;
X1=[X(1,1) X(5,1)];Y1=[X(1,2) X(5,2)];Z1=[X(1,3) X(5,3)];
line(X1,Y1,Z1);
X1=[X(1,1) X(6,1)];Y1=[X(1,2) X(6,2)];Z1=[X(1,3) X(6,3)];
line(X1,Y1,Z1);
X1=[X(2,1) X(3,1)];Y1=[X(2,2) X(3,2)];Z1=[X(2,3) X(3,3)];
line(X1,Y1,Z1);
X1=[X(3,1) X(4,1)];Y1=[X(3,2) X(4,2)];Z1=[X(3,3) X(4,3)];
line(X1,Y1,Z1);
X1=[X(3,1) X(10,1)];Y1=[X(3,2) X(10,2)];Z1=[X(3,3) X(10,3)];
line(X1,Y1,Z1);
X1=[X(4,1) X(5,1)];Y1=[X(4,2) X(5,2)];Z1=[X(4,3) X(5,3)];
line(X1,Y1,Z1);
X1=[X(4,1) X(10,1)];Y1=[X(4,2) X(10,2)];Z1=[X(4,3) X(10,3)];
line(X1,Y1,Z1);
X1=[X(5,1) X(9,1)];Y1=[X(5,2) X(9,2)];Z1=[X(5,3) X(9,3)];
line(X1,Y1,Z1);
X1=[X(6,1) X(9,1)];Y1=[X(6,2) X(9,2)];Z1=[X(6,3) X(9,3)];
line(X1,Y1,Z1);
X1=[X(7,1) X(8,1)];Y1=[X(7,2) X(8,2)];Z1=[X(7,3) X(8,3)];
line(X1,Y1,Z1);
X1=[X(9,1) X(8,1)];Y1=[X(9,2) X(8,2)];Z1=[X(9,3) X(8,3)];
P=zeros(10,3);a=1;thetamax=sqrt(X1(2)/a);thetamin=sqrt(X1(1)/a);dtheta=(thetamax-thetamin)/9;
P(1,:)=[X1(1) 2*a*thetamin Z1(1)];
P(2,:)=obtener_pto_parabola(a,dtheta,P(1,1),P(1,2),P(1,3));
P(3,:)=obtener_pto_parabola(a,dtheta,P(2,1),P(2,2),P(2,3));
P(4,:)=obtener_pto_parabola(a,dtheta,P(3,1),P(3,2),P(3,3));
P(5,:)=obtener_pto_parabola(a,dtheta,P(4,1),P(4,2),P(4,3));
P(6,:)=obtener_pto_parabola(a,dtheta,P(5,1),P(5,2),P(5,3));
P(7,:)=obtener_pto_parabola(a,dtheta,P(6,1),P(6,2),P(6,3));
P(8,:)=obtener_pto_parabola(a,dtheta,P(7,1),P(7,2),P(7,3));
P(9,:)=obtener_pto_parabola(a,dtheta,P(8,1),P(8,2),P(8,3));
P(10,:)=obtener_pto_parabola(a,dtheta,P(9,1),P(9,2),P(9,3));
X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);

X1=[X(8,1) X(10,1)];Y1=[X(8,2) X(10,2)];Z1=[X(8,3) X(10,3)];
line(X1,Y1,Z1);
xlim([min(X(:,1))-1 max(X(:,1))+1]);ylim([min(X(:,2))-1 max(X(:,2))+1]);zlim([min(X(:,3))-1 max(X(:,3))+1]);xlabel('x');ylabel('y');zlabel('z');
C=[(3 - 2) (2 - 1) (2 - 1)]./sqrt((3 - 2)^2+(2 - 1)^2+(2 - 1)^2);XP = X*[1 0 0 0;0 1 0 0;0 0 1 0;2 1 1 1]*[1 0 0 0;0 cos(acos(C(2)/sqrt(C(1)^2+C(2)^2))) sin(acos(C(2)/sqrt(C(1)^2+C(2)^2))) 0;0 -sin(acos(C(2)/sqrt(C(1)^2+C(2)^2))) cos(acos(C(2)/sqrt(C(1)^2+C(2)^2))) 0;0 0 0 1 ]*[cos(-asin(C(1))) sin(-asin(C(1))) 0 0;-sin(-asin(C(1))) cos(-asin(C(1))) 0 0;0 0 1 0;0 0 0 1 ]*[cos(-45) 0 -sin(-45) 0;0 1 0 0;sin(-45) 0 cos(-45) 0;0 0 0 1 ]*inv([cos(-asin(C(1))) sin(-asin(C(1))) 0 0;-sin(-asin(C(1))) cos(-asin(C(1))) 0 0;0 0 1 0;0 0 0 1 ])*inv([1 0 0 0;0 cos(acos(C(2)/sqrt(C(1)^2+C(2)^2))) sin(acos(C(2)/sqrt(C(1)^2+C(2)^2))) 0;0 -sin(acos(C(2)/sqrt(C(1)^2+C(2)^2))) cos(acos(C(2)/sqrt(C(1)^2+C(2)^2))) 0;0 0 0 1 ])*inv([1 0 0 0;0 1 0 0;0 0 1 0;2 1 1 1])
p1=1;t2 = sqrt((XP(2,1) -XP(1,1))^2 + (XP(2,2) -XP(1,2))^2 + (XP(2,3) -XP(1,3))^2);
p2=2;
t3 = sqrt((XP(7,1) -XP(2,1))^2 + (XP(7,2) -XP(2,2))^2 + (XP(7,3) -XP(2,3))^2);
p3=7;
t4 = sqrt((XP(6,1) -XP(7,1))^2 + (XP(6,2) -XP(7,2))^2 + (XP(6,3) -XP(7,3))^2);
p4=6;
G=[1 0.5 0 0 ;t3 2*(t2 + t3) t2 0 ;0 t4 2*(t3 + t4) t3 ;0 0  2 4]\[(3/(2*t2))*(XP(p2,1)-XP(p1,1))  (3/(2*t2))*(XP(p2,2)-XP(p1,2)) (3/(2*t2))*(XP(p2,3)-XP(p1,3));(3/(t2*t3))*(t2^2*(XP(p3,1)-XP(p2,1))+t3^2*(XP(p2,1)-XP(p1,1))) (3/(t2*t3))*(t2^2*(XP(p3,2)-XP(p2,2))+t3^2*(XP(p2,2)-XP(p1,2))) (3/(t2*t3))*(t2^2*(XP(p3,3)-XP(p2,3))+t3^2*(XP(p2,3)-XP(p1,3)));(3/(t3*t4))*(t3^2*(XP(p4,1)-XP(p3,1))+t4^2*(XP(p3,1)-XP(p2,1))) (3/(t3*t4))*(t3^2*(XP(p4,2)-XP(p3,2))+t4^2*(XP(p3,2)-XP(p2,2))) (3/(t3*t4))*(t3^2*(XP(p4,3)-XP(p3,3))+t4^2*(XP(p3,3)-XP(p2,3)));(6/t4)*(XP(p4,1)-XP(p3,1)) (6/t4)*(XP(p4,2)-XP(p3,2)) (6/t4)*(XP(p4,3)-XP(p3,3))];
P = [XP(1,1) XP(1,2) XP(1,3);
[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t2 (1/3)*((1/3)^2-(1/3))*t2]*[XP(p1,1) XP(p1,2) XP(p1,3); XP(p2,1) XP(p2,2) XP(p2,3);G(1,1) G(1,2) G(1,3); G(2,1) G(2,2) G(2,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t2 (2/3)*((2/3)^2-(2/3))*t2]*[XP(p1,1) XP(p1,2) XP(p1,3); XP(p2,1) XP(p2,2) XP(p2,3);G(1,1) G(1,2) G(1,3); G(2,1) G(2,2) G(2,3)];
XP(2,1) XP(2,2) XP(2,3);[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t3 (1/3)*((1/3)^2-(1/3))*t3]*[XP(p2,1) XP(p2,2) XP(p2,3); XP(p3,1) XP(p3,2) XP(p3,3);G(2,1) G(2,2) G(2,3); G(3,1) G(3,2) G(3,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t3 (2/3)*((2/3)^2-(2/3))*t3]*[XP(p2,1) XP(p2,2) XP(p2,3); XP(p3,1) XP(p3,2) XP(p3,3);G(2,1) G(2,2) G(2,3); G(3,1) G(3,2) G(3,3)];
XP(7,1) XP(7,2) XP(7,3);[2*(1/3)^3-3*(1/3)^2+1 (-2*(1/3)^3+3*(1/3)^2) (1/3)*((1/3)^2-2*(1/3)+1)*t4 (1/3)*((1/3)^2-(1/3))*t4]*[XP(p3,1) XP(p3,2) XP(p3,3); XP(p4,1) XP(p4,2) XP(p4,3);G(3,1) G(3,2) G(3,3); G(4,1) G(4,2) G(4,3)];
[2*(2/3)^3-3*(2/3)^2+1 (-2*(2/3)^3+3*(2/3)^2) (2/3)*((2/3)^2-2*(2/3)+1)*t4 (2/3)*((2/3)^2-(2/3))*t4]*[XP(p3,1) XP(p3,2) XP(p3,3); XP(p4,1) XP(p4,2) XP(p4,3);G(3,1) G(3,2) G(3,3); G(4,1) G(4,2) G(4,3)];
XP(6,1) XP(6,2) XP(6,3)];
subplot(1,2,2);X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);
view(3);hold on;
X1=[XP(1,1) XP(5,1)];Y1=[XP(1,2) XP(5,2)];Z1=[XP(1,3) XP(5,3)];
line(X1,Y1,Z1);
X1=[XP(1,1) XP(6,1)];Y1=[XP(1,2) XP(6,2)];Z1=[XP(1,3) XP(6,3)];
line(X1,Y1,Z1);
X1=[XP(2,1) XP(3,1)];Y1=[XP(2,2) XP(3,2)];Z1=[XP(2,3) XP(3,3)];
line(X1,Y1,Z1);
X1=[XP(3,1) XP(4,1)];Y1=[XP(3,2) XP(4,2)];Z1=[XP(3,3) XP(4,3)];
line(X1,Y1,Z1);
X1=[XP(3,1) XP(10,1)];Y1=[XP(3,2) XP(10,2)];Z1=[XP(3,3) XP(10,3)];
line(X1,Y1,Z1);
X1=[XP(4,1) XP(5,1)];Y1=[XP(4,2) XP(5,2)];Z1=[XP(4,3) XP(5,3)];
line(X1,Y1,Z1);
X1=[XP(4,1) XP(10,1)];Y1=[XP(4,2) XP(10,2)];Z1=[XP(4,3) XP(10,3)];
line(X1,Y1,Z1);
X1=[XP(5,1) XP(9,1)];Y1=[XP(5,2) XP(9,2)];Z1=[XP(5,3) XP(9,3)];
line(X1,Y1,Z1);
X1=[XP(6,1) XP(9,1)];Y1=[XP(6,2) XP(9,2)];Z1=[XP(6,3) XP(9,3)];
line(X1,Y1,Z1);
X1=[XP(7,1) XP(8,1)];Y1=[XP(7,2) XP(8,2)];Z1=[XP(7,3) XP(8,3)];
line(X1,Y1,Z1);
X1=[XP(9,1) XP(8,1)];Y1=[XP(9,2) XP(8,2)];Z1=[XP(9,3) XP(8,3)];
P=zeros(10,3);a=1;thetamax=sqrt(X1(2)/a);thetamin=sqrt(X1(1)/a);dtheta=(thetamax-thetamin)/9;
P(1,:)=[X1(1) 2*a*thetamin Z1(1)];
P(2,:)=obtener_pto_parabola(a,dtheta,P(1,1),P(1,2),P(1,3));
P(3,:)=obtener_pto_parabola(a,dtheta,P(2,1),P(2,2),P(2,3));
P(4,:)=obtener_pto_parabola(a,dtheta,P(3,1),P(3,2),P(3,3));
P(5,:)=obtener_pto_parabola(a,dtheta,P(4,1),P(4,2),P(4,3));
P(6,:)=obtener_pto_parabola(a,dtheta,P(5,1),P(5,2),P(5,3));
P(7,:)=obtener_pto_parabola(a,dtheta,P(6,1),P(6,2),P(6,3));
P(8,:)=obtener_pto_parabola(a,dtheta,P(7,1),P(7,2),P(7,3));
P(9,:)=obtener_pto_parabola(a,dtheta,P(8,1),P(8,2),P(8,3));
P(10,:)=obtener_pto_parabola(a,dtheta,P(9,1),P(9,2),P(9,3));
X1=[P(1,1) P(2,1)];Y1=[P(1,2) P(2,2)];Z1=[P(1,3) P(2,3)];line(X1,Y1,Z1);
X1=[P(2,1) P(3,1)];Y1=[P(2,2) P(3,2)];Z1=[P(2,3) P(3,3)];line(X1,Y1,Z1);
X1=[P(3,1) P(4,1)];Y1=[P(3,2) P(4,2)];Z1=[P(3,3) P(4,3)];line(X1,Y1,Z1);
X1=[P(4,1) P(5,1)];Y1=[P(4,2) P(5,2)];Z1=[P(4,3) P(5,3)];line(X1,Y1,Z1);
X1=[P(5,1) P(6,1)];Y1=[P(5,2) P(6,2)];Z1=[P(5,3) P(6,3)];line(X1,Y1,Z1);
X1=[P(6,1) P(7,1)];Y1=[P(6,2) P(7,2)];Z1=[P(6,3) P(7,3)];line(X1,Y1,Z1);
X1=[P(7,1) P(8,1)];Y1=[P(7,2) P(8,2)];Z1=[P(7,3) P(8,3)];line(X1,Y1,Z1);
X1=[P(8,1) P(9,1)];Y1=[P(8,2) P(9,2)];Z1=[P(8,3) P(9,3)];line(X1,Y1,Z1);
X1=[P(9,1) P(10,1)];Y1=[P(9,2) P(10,2)];Z1=[P(9,3) P(10,3)];line(X1,Y1,Z1);

X1=[XP(8,1) XP(10,1)];Y1=[XP(8,2) XP(10,2)];Z1=[XP(8,3) XP(10,3)];
line(X1,Y1,Z1);
xlim([min(XP(:,1))-1 max(XP(:,1))+1]);ylim([min(XP(:,2))-1 max(XP(:,2))+1]);zlim([min(XP(:,3))-1 max(XP(:,3))+1]);xlabel('x');ylabel('y');zlabel('z');